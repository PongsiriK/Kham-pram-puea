<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>เข้าห้องและดูคนในห้อง</title>
</head>
<body>
  <h2>เข้าห้อง</h2>
  <input id="nameInput" placeholder="ชื่อของคุณ" />
  <input id="roomInput" placeholder="รหัสห้อง" />
  <button onclick="joinRoom()">เข้าห้อง</button>

  <h3>คนในห้อง:</h3>
  <ul id="userList"></ul>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyDWVntpmELhdLufyHB4VFQA9pHE_pfxeV4",
  authDomain: "kham-pram-puea.firebaseapp.com",
  databaseURL: "https://kham-pram-puea-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "kham-pram-puea",
  storageBucket: "kham-pram-puea.firebasestorage.app",
  messagingSenderId: "971556304520",
  appId: "1:971556304520:web:58969028eb240c5cd5513d",
  measurementId: "G-N5QBBJX55R"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let roomId, userId;

    function joinRoom() {
      const name = document.getElementById('nameInput').value;
      roomId = document.getElementById('roomInput').value;
      if (!name || !roomId) return alert('ใส่ชื่อและรหัสห้องก่อน');

      userId = 'user_' + Math.random().toString(36).slice(2, 9);
      const userRef = db.ref(`rooms/${roomId}/users/${userId}`);
      userRef.set({ name });

      // ลบเมื่อปิดเว็บ
      window.addEventListener('beforeunload', () => userRef.remove());

      // แสดงรายชื่อผู้เล่นแบบ real-time
      db.ref(`rooms/${roomId}/users`).on('value', snapshot => {
        const list = document.getElementById('userList');
        list.innerHTML = '';
        const users = snapshot.val();
        for (const uid in users) {
          const li = document.createElement('li');
          li.textContent = users[uid].name;
          list.appendChild(li);
        }
      });
    }
  </script>
</body>
</html>


